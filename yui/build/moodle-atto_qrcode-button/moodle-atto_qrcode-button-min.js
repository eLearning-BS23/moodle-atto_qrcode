YUI.add("moodle-atto_qrcode-button",function(n,e){var o="atto_qrcode",t='<form class="mform atto_form atto_qrcode" id="atto_qrcode_form"><label for="qrcodecontent">'+M.str.atto_qrcode.qrcodecontent+'</label><input class="form-control fullwidth " type="text" id="qrcodecontent"required="true"/><label for="qrcode_size">'+M.str.atto_qrcode.qrcode_size+'</label><input class="form-control fullwidth " type="number" id="qrcode_size"required="true" size="10" value="{{qrcode_size_default}}" min="5" max="100000"/><label for="qrcode_margin">'+M.str.atto_qrcode.qrcode_margin+'</label><input class="form-control fullwidth " type="number" id="qrcode_margin"size="10"  min="5" max="100" required="true" value="{{qrcode_margin_default}}"/><div class="clearfix"></div><label for="qrcode_margin">'+M.str.atto_qrcode.backgroundcolor+'</label><div class="input-group"><div class="input-group-prepend"> <span class="input-group-text">'+M.str.atto_qrcode.red+'</span></div><input required type="number" class="form-control" value="{{bgcolor_r}}" id="bgcolor_r" aria-label="Red"><div class="input-group-prepend"> <span class="input-group-text">'+M.str.atto_qrcode.green+'</span></div><input required type="number" class="form-control" value="{{bgcolor_g}}" id="bgcolor_g"  aria-label="Green"><div class="input-group-prepend"> <span class="input-group-text">'+M.str.atto_qrcode.blue+'</span></div><input required type="number" class="form-control" value="{{bgcolor_b}}" id="bgcolor_b" aria-label="Blue"><div class="input-group-prepend"> <span class="input-group-text">'+M.str.atto_qrcode.alpha+'</span></div><input required type="number" class="form-control" value="{{bgcolor_a}}" id="bgcolor_a" aria-label="Alpha"></div><div class="clearfix"></div><label for="qrcode_margin">'+M.str.atto_qrcode.forgroungcolor+'</label><div class="input-group"><div class="input-group-prepend"> <span class="input-group-text">'+M.str.atto_qrcode.red+'</span></div><input required type="number" class="form-control" id="color_r" value="{{color_r}}" aria-label="Red"><div class="input-group-prepend"> <span class="input-group-text">'+M.str.atto_qrcode.green+'</span></div><input required type="number" class="form-control" id="color_g" value="{{color_g}}" aria-label="Green"><div class="input-group-prepend"> <span class="input-group-text">'+M.str.atto_qrcode.blue+'</span></div><input required type="number" class="form-control" id="color_b" value="{{color_b}}" aria-label="Blue"><div class="input-group-prepend"> <span class="input-group-text">'+M.str.atto_qrcode.alpha+'</span></div><input required type="number" class="form-control" id="color_a" value="{{color_a}}" aria-label="Alpha"></div><div class="clearfix"></div><div class="mdl-align"><br><button class="btn btn-secondary submit" type="submit">'+M.str.atto_qrcode.insertqrcode+"</button></div></form>";n.use("core/event").namespace("M.atto_qrcode").Button=n.Base.create("button",n.M.editor_atto.EditorPlugin,[],{_currentSelection:null,initializer:function(){this.get("disabled")||this.addButton({icon:"qrcode",iconComponent:o,callback:this._handleQrCodeGenerator,callbackArgs:"qrcode"})},_handleQrCodeGenerator:function(){this.getDialogue({headerContent:M.util.get_string("insertqrcode",o),focusAfterHide:!0,width:660}).set("bodyContent",this._getDialogueContent(this.get("host").getSelection())).show()},_getDialogueContent:function(e){var o={qrcode_size_default:this.get("size"),qrcode_margin_default:this.get("margin"),color_r:this.get("color_r"),color_g:this.get("color_g"),color_b:this.get("color_b"),color_a:this.get("color_a"),bgcolor_r:this.get("bgcolor_r"),bgcolor_g:this.get("bgcolor_g"),bgcolor_b:this.get("bgcolor_b"),bgcolor_a:this.get("bgcolor_a")},r=n.Node.create(n.Handlebars.compile(t)(o));return this._attachEvents(r,e)},_attachEvents:function(e,p){return e.one(".submit").on("click",function(e){var o=e.currentTarget.ancestor(".atto_form"),r=o.one("#qrcodecontent").get("value"),t=o.one("#qrcode_size").get("value"),a=o.one("#qrcode_margin").get("value"),l=o.one("#bgcolor_r").get("value"),c=o.one("#bgcolor_g").get("value"),n=o.one("#bgcolor_b").get("value"),i=o.one("#bgcolor_a").get("value"),s=o.one("#color_r").get("value"),u=o.one("#color_g").get("value"),d=o.one("#color_b").get("value"),g=o.one("#color_a").get("value"),_={bgcolor_r:l,bgcolor_g:c,bgcolor_b:n,bgcolor_a:i,color_r:s,color_g:u,color_b:d,color_a:g};r&&t&&a&&(e.preventDefault(),this._getMediaHTMLQrcode(p,r,t,a,_))},this),e},_getMediaHTMLQrcode:function(a,e,o,r,t){var l=this,c=this._getQrCode(e,o,r,t);c.then(function(e){var o={base64qrcode:e.data},r=n.Handlebars.compile('<img src="{{base64qrcode}}" alt="" />')(o),t=l.get("host");l.getDialogue({focusAfterHide:null}).hide(),r&&(t.setSelection(a),t.insertContentAtFocusPoint(r),l.markUpdated())})["catch"](function(e){})},_getQrCode:function(e,o,r,t){var c=this;return new n.Promise(function(a,l){n.io(M.cfg.wwwroot+"/lib/editor/atto/plugins/qrcode/ajax.php",{context:c,data:n.merge({sesskey:M.cfg.sesskey,contextid:c.get("contextid"),content:e,size:o,margin:r},t),timeout:500,on:{success:function(e,o,r){try{a(n.JSON.parse(o.response))}catch(t){l(t)}},failure:function(e,o,r){l(new Error(o))}}})})}},{ATTRS:{disabled:{value:!1},contextid:{value:null},size:{value:300},margin:{value:10},bgcolor_r:{value:255},bgcolor_g:{value:255},bgcolor_b:{value:255},bgcolor_a:{value:0},color_r:{value:0},color_g:{value:0},color_b:{value:0},color_a:{value:0}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});